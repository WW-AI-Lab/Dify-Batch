# Dify Workflow批量执行系统 - 功能测试计划

## 测试概述

本文档描述了Dify Workflow批量执行系统的完整功能测试计划，确保所有核心功能正常工作。

## 测试环境

- **系统**: macOS 24.5.0 (Apple Silicon)
- **Python**: 3.x + 虚拟环境 (.venv)
- **服务地址**: http://localhost:8000
- **数据库**: SQLite (本地)

## 核心功能测试

### 1. 工作流管理测试 ✅

#### 1.1 添加工作流
- [ ] 打开工作流管理页面 `/workflows`
- [ ] 点击"添加新工作流"按钮
- [ ] 输入有效的 Dify API 配置
- [ ] 验证工作流信息自动获取
- [ ] 确认工作流成功保存

#### 1.2 编辑工作流
- [ ] 选择现有工作流点击"编辑"
- [ ] 修改工作流信息
- [ ] 验证更新成功

#### 1.3 删除工作流
- [ ] 选择工作流点击"删除"
- [ ] 确认删除操作
- [ ] 验证工作流从列表中移除

### 2. 批量执行测试 🔄

#### 2.1 文件上传和验证
- [ ] 访问批量执行页面 `/batch`
- [ ] 选择工作流
- [ ] 下载Excel模板
- [ ] 填写测试数据
- [ ] 上传Excel文件
- [ ] 验证文件格式和数据结构

#### 2.2 批量任务执行
- [ ] 配置执行参数（并发数、重试次数、超时时间）
- [ ] 启动批量执行
- [ ] 验证任务状态变为"执行中"
- [ ] 观察实时进度更新

#### 2.3 任务控制功能
- [ ] **暂停任务**: 点击暂停按钮，验证任务状态变为"已暂停"
- [ ] **恢复任务**: 点击恢复按钮，验证任务继续执行
- [ ] **停止任务**: 点击停止按钮，验证任务状态变为"已取消"

#### 2.4 结果下载
- [ ] 等待任务完成
- [ ] 点击"下载结果"按钮
- [ ] 验证Excel文件包含正确的执行结果
- [ ] 检查输出内容是否正确解析

### 3. 任务管理测试 📋

#### 3.1 任务列表
- [ ] 查看任务列表页面
- [ ] 验证任务状态显示正确
- [ ] 测试分页功能

#### 3.2 任务详情
- [ ] 点击"查看详情"按钮
- [ ] 验证任务统计信息
- [ ] 检查执行进度和时间信息

#### 3.3 任务删除
- [ ] 选择已完成的任务
- [ ] 点击"删除任务"按钮
- [ ] 确认删除操作
- [ ] 验证任务和相关文件被删除

### 4. 错误处理测试 ⚠️

#### 4.1 API错误处理
- [ ] 使用无效的API配置
- [ ] 验证错误信息正确显示
- [ ] 测试网络超时情况

#### 4.2 文件错误处理
- [ ] 上传格式错误的文件
- [ ] 上传数据结构不匹配的文件
- [ ] 验证错误提示清晰明确

#### 4.3 任务执行错误
- [ ] 使用会导致执行失败的数据
- [ ] 验证重试机制工作正常
- [ ] 检查错误日志记录

## 性能测试

### 5.1 并发执行测试
- [ ] 创建包含50+行数据的Excel文件
- [ ] 设置不同的并发数（1, 3, 5）
- [ ] 测试执行性能和稳定性

### 5.2 大文件处理
- [ ] 测试100+行数据的批量处理
- [ ] 验证内存使用情况
- [ ] 检查执行时间合理性

## 用户体验测试

### 6.1 界面响应性
- [ ] 测试所有按钮和链接
- [ ] 验证加载状态显示
- [ ] 检查错误提示用户友好性

### 6.2 操作流程
- [ ] 完整走通从添加工作流到下载结果的流程
- [ ] 验证操作步骤直观易懂
- [ ] 测试各种边界情况

## 测试数据准备

### 测试工作流配置
```json
{
  "name": "测试工作流",
  "base_url": "https://api.dify.ai/v1",
  "api_key": "app-xxx"
}
```

### 测试Excel数据
创建包含以下列的Excel文件：
- 必填参数列
- 可选参数列
- 各种数据类型（文本、数字、布尔值）

## 验收标准

### 功能完整性
- [ ] 所有核心功能正常工作
- [ ] 错误处理机制完善
- [ ] 用户操作流程顺畅

### 性能要求
- [ ] 单个任务执行时间 < 30秒
- [ ] 批量任务响应时间 < 5秒
- [ ] 界面操作响应时间 < 2秒

### 稳定性要求
- [ ] 连续执行10个批量任务无异常
- [ ] 并发执行多个任务无冲突
- [ ] 系统资源使用合理

## 问题记录

### 已知问题
1. **删除任务功能**: 前端错误处理已优化 ✅
2. **停止任务功能**: 前端错误处理已优化 ✅
3. **暂停/恢复功能**: 新增API端点和前端支持 ✅

### 待验证功能
1. **批量执行核心逻辑**: 需要实际测试验证
2. **进度追踪系统**: 需要验证实时更新
3. **结果文件生成**: 需要验证输出解析正确性

## 测试执行记录

| 测试项目 | 状态 | 执行时间 | 备注 |
|---------|------|----------|------|
| 工作流管理 | ✅ | 2024-06-13 | 所有功能正常 |
| 文件上传 | ✅ | 2024-06-13 | 验证和解析正常 |
| 批量执行 | 🔄 | 待测试 | 核心功能待验证 |
| 任务控制 | 🔄 | 待测试 | 暂停/恢复/停止 |
| 结果下载 | 🔄 | 待测试 | 输出解析验证 |

---

**最后更新**: 2024年6月13日  
**测试负责人**: AI Assistant  
**测试状态**: 准备阶段完成，开始执行测试 